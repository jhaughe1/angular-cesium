{"version":3,"sources":["cesium-heatmap-material-creator.ts"],"names":[],"mappings":"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","file":"cesium-heatmap-material-creator.js","sourceRoot":"","sourcesContent":["import { Rectangle } from './cesium-heatmap-material-creator';\r\nimport { Cartesian2 } from './../angular-cesium/models/cartesian2';\r\nimport { Cartesian3 } from './../angular-cesium/models/cartesian3';\r\nimport { GeoUtilsService } from '../angular-cesium/services/geo-utils/geo-utils.service';\r\nimport * as h337 from 'heatmap.js/build/heatmap.js';\r\nimport { Injectable } from '@angular/core';\r\n\r\n// Consider moving to a different package.\r\n\r\nif (!h337) {\r\n  throw new Error('must install heatmap.js. please do npm -i heatmap.js ')\r\n}\r\n\r\n\r\nexport interface Rectangle {\r\n  west: number;\r\n  south: number;\r\n  east: number;\r\n  north: number;\r\n}\r\n\r\n\r\n/**\r\n *  x: lon\r\n *  y: lat\r\n *  value: point value\r\n */\r\nexport interface HeatPointDataPoint {\r\n  x: number,\r\n  y: number,\r\n  value: number,\r\n}\r\n\r\n/**\r\n *   min:  the minimum allowed value for the data values\r\n *  max:  the maximum allowed value for the data values\r\n *  heatPointsData: an array of data points in WGS84 coordinates and values like { x:lon, y:lat, value)\r\n */\r\nexport interface HeatmapDataSet {\r\n  min?: number,\r\n  max?: number,\r\n  heatPointsData: HeatPointDataPoint[]\r\n}\r\n\r\n/**\r\n * a heatmap.js options object (see http://www.patrick-wied.at/static/heatmapjs/docs.html#h337-create)\r\n */\r\nexport interface HeatMapOptions {\r\n  [propName: string]: any,\r\n  \r\n  gradient?: any\r\n  radius?: number\r\n  opacity?: number\r\n  maxOpacity?: number\r\n  minOpacity?: number\r\n  blur?: any\r\n}\r\n\r\n/**\r\n * Create heatmap material (Cesium.ImageMaterialProperty with heatmap as the image)\r\n * works with http://www.patrick-wied.at/static/heatmapjs. must do npm -i heatmap.js\r\n * usage:\r\n * ```\r\n *\r\n const mCreator = new CesiumHeatMapMaterialCreator();\r\n const containingRect = CesiumHeatMapMaterialCreator.calcCircleContainingRect(this.circleCenter, this.circleRadius);\r\n const userHeatmapOptions = {\r\n\t\t\tradius : 2000,\r\n\t\t\tminOpacity : 0,\r\n\t\t\tmaxOpacity : 0.9,\r\n\t\t} as any;\r\n \r\n this.circleHeatMapMaterial = mCreator.create(containingRect, {\r\n\t\t\theatPointsData : [\r\n\t\t\t\t{\r\n\t\t\t\t\tx : -100.0,\r\n\t\t\t\t\ty : 24.0,\r\n\t\t\t\t\tvalue : 95\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t\tmin : 0,\r\n\t\t\tmax : 100,\r\n\t\t}, userHeatmapOptions);\r\n * ```\r\n *\r\n * inspired by https://github.com/danwild/CesiumHeatmap\r\n */\r\n\r\nexport class CesiumHeatMapMaterialCreator {\r\n  private static containerCanvasCounter = 0;\r\n  \r\n  /**\r\n   *\r\n   * @param center - Cartesian3\r\n   * @param radius - Meters\r\n   */\r\n  static calcCircleContainingRect(center: Cartesian3, radius: number) {\r\n    return CesiumHeatMapMaterialCreator.calcEllipseContainingRect(center, radius, radius);\r\n  }\r\n  \r\n  /**\r\n   *\r\n   * @param center - Cartesian3\r\n   * @param semiMinorAxis - meters\r\n   * @param semiMajorAxis - meters\r\n   */\r\n  static calcEllipseContainingRect(center: Cartesian3, semiMajorAxis: number, semiMinorAxis: number) {\r\n    const top = GeoUtilsService.pointByLocationDistanceAndAzimuth(\r\n      center,\r\n      semiMinorAxis,\r\n      0,\r\n      true\r\n    );\r\n    const right = GeoUtilsService.pointByLocationDistanceAndAzimuth(\r\n      center,\r\n      semiMajorAxis,\r\n      Math.PI / 2,\r\n      true\r\n    );\r\n    const bottom = GeoUtilsService.pointByLocationDistanceAndAzimuth(\r\n      center,\r\n      semiMajorAxis,\r\n      Math.PI,\r\n      true\r\n    );\r\n    const left = GeoUtilsService.pointByLocationDistanceAndAzimuth(\r\n      center,\r\n      semiMajorAxis,\r\n      Math.PI * 1.5,\r\n      true\r\n    );\r\n    \r\n    const ellipsePoints = [top, right, bottom, left];\r\n    return Cesium.Rectangle.fromCartesianArray(ellipsePoints);\r\n  }\r\n  \r\n  /**\r\n   *\r\n   * @param {Cartesian3[]} points\r\n   */\r\n  static calculateContainingRectFromPoints(points: Cartesian3[]) {\r\n    return Cesium.Rectangle.fromCartesianArray(points);\r\n  }\r\n  \r\n  heatmapOptionsDefaults = {\r\n    minCanvasSize : 700,           // minimum size (in pixels) for the heatmap canvas\r\n    maxCanvasSize : 2000,          // maximum size (in pixels) for the heatmap canvas\r\n    radiusFactor : 60,             // data point size factor used if no radius is given\r\n    // (the greater of height and width divided by this number yields the used radius)\r\n    spacingFactor : 1,           // extra space around the borders (point radius multiplied by this number yields the spacing)\r\n    maxOpacity : 0.8,              // the maximum opacity used if not given in the heatmap options object\r\n    minOpacity : 0.1,              // the minimum opacity used if not given in the heatmap options object\r\n    blur : 0.85,                   // the blur used if not given in the heatmap options object\r\n    gradient : {                   // the gradient used if not given in the heatmap options object\r\n      '.3' : 'blue',\r\n      '.65' : 'yellow',\r\n      '.8' : 'orange',\r\n      '.95' : 'red'\r\n    },\r\n  };\r\n  \r\n  WMP = new Cesium.WebMercatorProjection();\r\n  _spacing: number;\r\n  width: number;\r\n  height: number;\r\n  _mbounds: any;\r\n  bounds: any;\r\n  _factor: number;\r\n  _rectangle: Rectangle;\r\n  heatmap: any;\r\n  _xoffset: any;\r\n  _yoffset: any;\r\n  \r\n  \r\n  /**  Set an array of heatmap locations\r\n   *\r\n   *  min:  the minimum allowed value for the data values\r\n   *  max:  the maximum allowed value for the data values\r\n   *  data: an array of data points in heatmap coordinates and values like {x, y, value}\r\n   */\r\n  setData(min: any, max: any, data: any) {\r\n    if (data && data.length > 0 && min !== null && min !== false && max !== null && max !== false) {\r\n      this.heatmap.setData({\r\n        min : min,\r\n        max : max,\r\n        data : data\r\n      });\r\n      \r\n      return true;\r\n    }\r\n    \r\n    return false;\r\n  };\r\n  \r\n  \r\n  /**  Set an array of WGS84 locations\r\n   *\r\n   *  min:  the minimum allowed value for the data values\r\n   *  max:  the maximum allowed value for the data values\r\n   *  data: an array of data points in WGS84 coordinates and values like { x:lon, y:lat, value }\r\n   */\r\n  private setWGS84Data(min: any, max: any, data: any) {\r\n    if (data && data.length > 0 && min !== null && min !== false && max !== null && max !== false) {\r\n      const convdata = [];\r\n      \r\n      for (let i = 0; i < data.length; i++) {\r\n        const gp = data[i];\r\n        \r\n        const hp = this.wgs84PointToHeatmapPoint(gp);\r\n        if (gp.value || gp.value === 0) {\r\n          hp.value = gp.value;\r\n        }\r\n        \r\n        convdata.push(hp);\r\n      }\r\n      \r\n      return this.setData(min, max, convdata);\r\n    }\r\n    \r\n    return false;\r\n  };\r\n  \r\n  /**  Convert a mercator location to the corresponding heatmap location\r\n   *\r\n   *  p: a WGS84 location like {x: lon, y:lat}\r\n   */\r\n  private mercatorPointToHeatmapPoint(p: Cartesian2) {\r\n    const pn: any = {};\r\n    \r\n    pn.x = Math.round((p.x - this._xoffset) / this._factor + this._spacing);\r\n    pn.y = Math.round((p.y - this._yoffset) / this._factor + this._spacing);\r\n    pn.y = this.height - pn.y;\r\n    \r\n    return pn;\r\n  };\r\n  \r\n  /**  Convert a WGS84 location to the corresponding heatmap location\r\n   *\r\n   *  p: a WGS84 location like {x:lon, y:lat}\r\n   */\r\n  private wgs84PointToHeatmapPoint = function (p: Cartesian2) {\r\n    return this.mercatorPointToHeatmapPoint(this.wgs84ToMercator(p));\r\n  };\r\n  \r\n  \r\n  private createContainer(height: number, width: number) {\r\n    const id = 'heatmap' + CesiumHeatMapMaterialCreator.containerCanvasCounter++;\r\n    const container = document.createElement('div');\r\n    container.setAttribute('id', id);\r\n    container.setAttribute('style', 'width: ' + width + 'px; height: ' + height + 'px; margin: 0px; display: none;');\r\n    document.body.appendChild(container);\r\n    return {container, id};\r\n  }\r\n  \r\n  /**  Convert a WGS84 location into a mercator location\r\n   *\r\n   *  p: the WGS84 location like {x: lon, y: lat}\r\n   */\r\n  private wgs84ToMercator(p: Cartesian2) {\r\n    const mp = this.WMP.project(Cesium.Cartographic.fromDegrees(p.x, p.y));\r\n    return {\r\n      x : mp.x,\r\n      y : mp.y\r\n    };\r\n  };\r\n  \r\n  private rad2deg = function (r: number) {\r\n    const d = r / (Math.PI / 180.0);\r\n    return d;\r\n  };\r\n  \r\n  /**  Convert a WGS84 bounding box into a mercator bounding box*\r\n   *  bb: the WGS84 bounding box like {north, east, south, west}\r\n   */\r\n  private wgs84ToMercatorBB(bb: any) {\r\n    // TODO validate rad or deg\r\n    const sw = this.WMP.project(Cesium.Cartographic.fromRadians(bb.west, bb.south));\r\n    const ne = this.WMP.project(Cesium.Cartographic.fromRadians(bb.east, bb.north));\r\n    return {\r\n      north : ne.y,\r\n      east : ne.x,\r\n      south : sw.y,\r\n      west : sw.x\r\n    };\r\n  };\r\n  \r\n  /**  Convert a mercator bounding box into a WGS84 bounding box\r\n   *\r\n   *  bb: the mercator bounding box like {north, east, south, west}\r\n   */\r\n  private mercatorToWgs84BB(bb: any) {\r\n    const sw = this.WMP.unproject(new Cesium.Cartesian3(bb.west, bb.south));\r\n    const ne = this.WMP.unproject(new Cesium.Cartesian3(bb.east, bb.north));\r\n    return {\r\n      north : this.rad2deg(ne.latitude),\r\n      east : this.rad2deg(ne.longitude),\r\n      south : this.rad2deg(sw.latitude),\r\n      west : this.rad2deg(sw.longitude)\r\n    };\r\n  };\r\n  \r\n  private setWidthAndHeight(mbb: any) {\r\n    this.width = ((mbb.east > 0 && mbb.west < 0) ? mbb.east + Math.abs(mbb.west) : Math.abs(mbb.east - mbb.west));\r\n    this.height = ((mbb.north > 0 && mbb.south < 0) ? mbb.north + Math.abs(mbb.south) : Math.abs(mbb.north - mbb.south));\r\n    this._factor = 1;\r\n    \r\n    if (this.width > this.height && this.width > this.heatmapOptionsDefaults.maxCanvasSize) {\r\n      this._factor = this.width / this.heatmapOptionsDefaults.maxCanvasSize;\r\n      \r\n      if (this.height / this._factor < this.heatmapOptionsDefaults.minCanvasSize) {\r\n        this._factor = this.height / this.heatmapOptionsDefaults.minCanvasSize;\r\n      }\r\n    } else if (this.height > this.width && this.height > this.heatmapOptionsDefaults.maxCanvasSize) {\r\n      this._factor = this.height / this.heatmapOptionsDefaults.maxCanvasSize;\r\n      \r\n      if (this.width / this._factor < this.heatmapOptionsDefaults.minCanvasSize) {\r\n        this._factor = this.width / this.heatmapOptionsDefaults.minCanvasSize;\r\n      }\r\n    } else if (this.width < this.height && this.width < this.heatmapOptionsDefaults.minCanvasSize) {\r\n      this._factor = this.width / this.heatmapOptionsDefaults.minCanvasSize;\r\n      \r\n      if (this.height / this._factor > this.heatmapOptionsDefaults.maxCanvasSize) {\r\n        this._factor = this.height / this.heatmapOptionsDefaults.maxCanvasSize;\r\n      }\r\n    } else if (this.height < this.width && this.height < this.heatmapOptionsDefaults.minCanvasSize) {\r\n      this._factor = this.height / this.heatmapOptionsDefaults.minCanvasSize;\r\n      \r\n      if (this.width / this._factor > this.heatmapOptionsDefaults.maxCanvasSize) {\r\n        this._factor = this.width / this.heatmapOptionsDefaults.maxCanvasSize;\r\n      }\r\n    }\r\n    \r\n    this.width = this.width / this._factor;\r\n    this.height = this.height / this._factor;\r\n  };\r\n  \r\n  /**\r\n   * containingBoundingRect: Cesium.Rectangle like {north, east, south, west}\r\n   * min:  the minimum allowed value for the data values\r\n   * max:  the maximum allowed value for the data values\r\n   * datapoint: {x,y,value}\r\n   * heatmapOptions: a heatmap.js options object (see http://www.patrick-wied.at/static/heatmapjs/docs.html#h337-create)\r\n   *\r\n   */\r\n  public create(containingBoundingRect: Rectangle, heatmapDataSet: HeatmapDataSet, heatmapOptions: HeatMapOptions) {\r\n    const userBB = containingBoundingRect;\r\n    const {heatPointsData, min = 0, max = 100} = heatmapDataSet;\r\n    const finalHeatmapOptions = Object.assign({}, this.heatmapOptionsDefaults, heatmapOptions);\r\n    \r\n    this._mbounds = this.wgs84ToMercatorBB(userBB);\r\n    this.setWidthAndHeight(this._mbounds);\r\n    \r\n    finalHeatmapOptions.radius = Math.round((heatmapOptions.radius) ?\r\n      heatmapOptions.radius : ((this.width > this.height) ?\r\n        this.width / this.heatmapOptionsDefaults.radiusFactor :\r\n        this.height / this.heatmapOptionsDefaults.radiusFactor));\r\n    this._spacing = finalHeatmapOptions.radius * this.heatmapOptionsDefaults.spacingFactor;\r\n    this._xoffset = this._mbounds.west;\r\n    this._yoffset = this._mbounds.south;\r\n    \r\n    this.width = Math.round(this.width + this._spacing * 2);\r\n    this.height = Math.round(this.height + this._spacing * 2);\r\n    \r\n    this._mbounds.west -= this._spacing * this._factor;\r\n    this._mbounds.east += this._spacing * this._factor;\r\n    this._mbounds.south -= this._spacing * this._factor;\r\n    this._mbounds.north += this._spacing * this._factor;\r\n    \r\n    this.bounds = this.mercatorToWgs84BB(this._mbounds);\r\n    this._rectangle = Cesium.Rectangle.fromDegrees(this.bounds.west, this.bounds.south, this.bounds.east, this.bounds.north);\r\n    \r\n    const {container, id} = this.createContainer(this.height, this.width);\r\n    Object.assign(finalHeatmapOptions, {container});\r\n    \r\n    this.heatmap = h337.create(finalHeatmapOptions);\r\n    \r\n    \r\n    this.setWGS84Data(0, 100, heatPointsData);\r\n    const heatMapCanvas = this.heatmap._renderer.canvas;\r\n    const heatMapMaterial = new Cesium.ImageMaterialProperty({\r\n      image : heatMapCanvas,\r\n      transparent : true,\r\n    });\r\n    this.setClear(heatMapMaterial, id);\r\n    \r\n    return heatMapMaterial;\r\n  }\r\n  \r\n  private setClear(heatMapMaterial: any, id: string) {\r\n    heatMapMaterial.clear = () => {\r\n      const elem = document.getElementById(id);\r\n      return elem.parentNode.removeChild(elem);\r\n    };\r\n  }\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n];\n}\r\n\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}