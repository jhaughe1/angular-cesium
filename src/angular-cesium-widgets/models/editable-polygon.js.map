{"version":3,"sources":["editable-polygon.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,OAAO,EAAE,QAAQ,EAAE,MAAM,uCAAuC,CAAC;AACjE,OAAO,EAAE,SAAS,EAAE,MAAM,cAAc,CAAC;AACzC,OAAO,EAAE,YAAY,EAAE,MAAM,iBAAiB,CAAC;AAI/C,OAAO,EAAE,eAAe,EAAE,MAAM,2DAA2D,CAAC;AAG5F,OAAO,EAAE,iBAAiB,EAAc,MAAM,eAAe,CAAC;AAE9D;IAAqC,mCAAQ;IAY3C,yBAAoB,EAAU,EACV,aAA+B,EAC/B,WAA6B,EAC7B,cAAgC,EAChC,mBAAwC,EAChD,cAAkC,EAClC,SAAwB;QANpC,YAOE,iBAAO,SAOR;QAdmB,QAAE,GAAF,EAAE,CAAQ;QACV,mBAAa,GAAb,aAAa,CAAkB;QAC/B,iBAAW,GAAX,WAAW,CAAkB;QAC7B,oBAAc,GAAd,cAAc,CAAkB;QAChC,yBAAmB,GAAnB,mBAAmB,CAAqB;QAfpD,eAAS,GAAgB,EAAE,CAAC;QAC5B,eAAS,GAAmB,EAAE,CAAC;QAE/B,kBAAY,GAAG,KAAK,CAAC;QACrB,iBAAW,GAAG,IAAI,CAAC;QAKnB,aAAO,GAAiB,EAAE,CAAC;QAUjC,KAAI,CAAC,YAAY,GAAG,cAAc,CAAC,YAAY,CAAC;QAChD,KAAI,CAAC,iBAAiB,GAAG,cAAc,CAAC,UAAU,CAAC;QACnD,KAAI,CAAC,oBAAoB,GAAG,cAAc,CAAC,aAAa,CAAC;QACzD,EAAE,CAAC,CAAC,SAAS,IAAI,SAAS,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC;YACvC,KAAI,CAAC,kBAAkB,CAAC,SAAS,CAAC,CAAC;QACrC,CAAC;;IACH,CAAC;IAED,sBAAI,mCAAM;aAAV;YACE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;QACtB,CAAC;aAED,UAAW,MAAoB;YAC7B,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;gBACZ,MAAM,CAAC;YACT,CAAC;YACD,IAAM,SAAS,GAAG,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC1C,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,GAAG,CAAC,UAAC,KAAK,EAAE,KAAK;gBACrC,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACpB,KAAK,CAAC,QAAQ,GAAG,SAAS,CAAC,KAAK,CAAC,CAAC;gBACpC,CAAC;gBAED,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,iBAAiB,EAAE,KAAK,CAAC,CAAC;YACrD,CAAC,CAAC,CAAC;QACL,CAAC;;;OAdA;IAgBD,sBAAI,iDAAoB;aAAxB;YACE,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC;QACpC,CAAC;aAED,UAAyB,KAAoB;YAC3C,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;QACrC,CAAC;;;OAJA;IAMD,sBAAI,8CAAiB;aAArB;YACE,MAAM,CAAC,IAAI,CAAC,kBAAkB,CAAC;QACjC,CAAC;aAUD,UAAsB,KAAiB;YACrC,IAAI,CAAC,kBAAkB,GAAG,KAAK,CAAC;QAClC,CAAC;;;OAZA;IAED,sBAAI,yCAAY;aAAhB;YACE,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC;QAC5B,CAAC;aAED,UAAiB,KAAmB;YAClC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;QAC7B,CAAC;;;OAJA;IAUD,sBAAI,uCAAU;aAAd;YACE,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC;QAC1B,CAAC;aAED,UAAe,KAAc;YAA7B,iBAMC;YALC,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;YACzB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,KAAK;gBAC1B,KAAK,CAAC,IAAI,GAAG,KAAK,CAAC;gBACnB,KAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC;YACvC,CAAC,CAAC,CAAC;QACL,CAAC;;;OARA;IAUO,4CAAkB,GAA1B,UAA2B,SAAuB;QAAlD,iBAOC;QANC,SAAS,CAAC,OAAO,CAAC,UAAC,QAAQ;YACzB,KAAI,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CAAA;QACrC,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAC/B,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;IAC3B,CAAC;IAED,2CAAiB,GAAjB,UAAkB,MAAyE,EAAE,YAA2B;QAAxH,iBAsBC;QArBC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACvB,MAAM,IAAI,KAAK,CAAC,6DAA6D,CAAC,CAAA;QAChF,CAAC;QAED,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,EAAE,CAAC,EAAlC,CAAkC,CAAC,CAAC;QAChE,IAAM,SAAS,GAAgB,EAAE,CAAC;QAClC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACvC,IAAM,gBAAgB,GAAQ,MAAM,CAAC,CAAC,CAAC,CAAC;YACxC,IAAI,QAAQ,GAAG,IAAI,CAAC;YACpB,EAAE,CAAC,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC;gBAChC,QAAQ,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,gBAAgB,CAAC,QAAQ,EAAE,gBAAgB,CAAC,UAAU,CAAC,CAAC;YAC5F,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,QAAQ,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,gBAAgB,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAC9E,CAAC;YACD,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC3B,CAAC;QACD,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;QAC3B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC;QACpE,IAAI,CAAC,iBAAiB,OAAtB,IAAI,GAAmB,IAAI,SAAK,IAAI,CAAC,SAAS,GAAE;QAChD,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAC/B,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAEO,iDAAuB,GAA/B;QAAA,iBASC;QARC,IAAM,aAAa,GAAO,IAAI,CAAC,SAAS,QAAC,CAAC;QAC1C,aAAa,CAAC,OAAO,CAAC,UAAC,GAAG,EAAE,KAAK;YAC/B,IAAM,YAAY,GAAG,GAAG,CAAC;YACzB,IAAM,SAAS,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,aAAa,CAAC,MAAM,CAAC,CAAC;YACvD,IAAM,SAAS,GAAG,aAAa,CAAC,SAAS,CAAC,CAAC;YAC3C,IAAM,QAAQ,GAAG,KAAI,CAAC,qBAAqB,CAAC,YAAY,EAAE,SAAS,CAAC,CAAC;YACrE,KAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,+CAAqB,GAA7B,UAA8B,MAAiB,EAAE,OAAkB;QACjE,IAAM,WAAW,GAAG,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC;QAC5E,IAAM,QAAQ,GAAG,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,CAAC;QAC1E,IAAM,kBAAkB,GAAG,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;QAChG,IAAM,QAAQ,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,kBAAkB,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACpF,QAAQ,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QAEnC,IAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAClD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,UAAU,GAAG,CAAC,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAC;QACnD,MAAM,CAAC,QAAQ,CAAC;IAClB,CAAC;IAEO,kDAAwB,GAAhC,UAAiC,gBAA2B,EAAE,SAAoB,EAAE,SAAoB;QACtG,IAAM,aAAa,GAAG,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,CAAC;QACjF,IAAM,aAAa,GAAG,MAAM,CAAC,YAAY,CAAC,aAAa,CAAC,SAAS,CAAC,WAAW,EAAE,CAAC,CAAC;QACjF,gBAAgB,CAAC,WAAW,CAAC,IAAI,CAAC,mBAAmB,CAAC,oBAAoB,CAAC,aAAa,EAAE,aAAa,CAAC,CAAC,CAAC;IAC5G,CAAC;IAED,uDAA6B,GAA7B,UAA8B,KAAgB;QAC5C,KAAK,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;QACjC,IAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;QAC1C,IAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;QACjD,IAAM,SAAS,GAAG,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC;QACnD,IAAM,QAAQ,GAAG,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,WAAW,CAAE,GAAG,WAAW,CAAC;QAEjE,IAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;QAC5C,IAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;QAE1C,IAAM,aAAa,GAAG,IAAI,CAAC,qBAAqB,CAAC,QAAQ,EAAE,KAAK,CAAC,CAAC;QAClE,IAAM,WAAW,GAAG,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;QACjE,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,aAAa,EAAE,WAAW,EAAE,KAAK,CAAC,CAAC;QAChE,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAE7B,CAAC;IAEO,yCAAe,GAAvB;QAAA,iBAWC;QAVC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,QAAQ,IAAI,OAAA,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,CAAC,KAAK,EAAE,CAAC,EAA5C,CAA4C,CAAC,CAAC;QACjF,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,IAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,UAAA,GAAG,IAAI,OAAA,CAAC,GAAG,CAAC,kBAAkB,EAAE,EAAzB,CAAyB,CAAC,CAAC;QAC3E,UAAU,CAAC,OAAO,CAAC,UAAC,KAAK,EAAE,KAAK;YAC9B,IAAM,SAAS,GAAG,CAAC,KAAK,GAAG,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,CAAC;YACpD,IAAM,SAAS,GAAG,UAAU,CAAC,SAAS,CAAC,CAAC;YACxC,IAAM,QAAQ,GAAG,IAAI,YAAY,CAAC,KAAI,CAAC,EAAE,EAAE,KAAK,CAAC,WAAW,EAAE,EAAE,SAAS,CAAC,WAAW,EAAE,EAAE,KAAI,CAAC,oBAAoB,CAAC,CAAC;YACpH,KAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAC9B,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,EAAE,QAAQ,CAAC,KAAK,EAAE,CAAC,CAAC;QACzD,CAAC,CAAC,CAAC;IACL,CAAC;IAED,8CAAoB,GAApB,UAAqB,QAAoB;QACvC,IAAM,QAAQ,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;QAC1E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC9B,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;IACzC,CAAC;IAGD,kCAAQ,GAAR,UAAS,QAAoB;QAC3B,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACtB,MAAM,CAAC;QACT,CAAC;QACD,IAAM,YAAY,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;QAC5C,EAAE,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC;YACjB,IAAM,UAAU,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAC5E,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YAChC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,UAAU,CAAC,CAAC;QAC3C,CAAC;QAED,IAAI,CAAC,WAAW,GAAG,IAAI,SAAS,CAAC,IAAI,CAAC,EAAE,EAAE,QAAQ,CAAC,KAAK,EAAE,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;QACpF,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAEtC,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QAC/C,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,mCAAS,GAAT,UAAU,UAAsB,EAAE,SAAoB;QACpD,SAAS,CAAC,WAAW,CAAC,UAAU,CAAC,CAAC;QAClC,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAC3B,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACtB,EAAE,CAAC,CAAC,SAAS,CAAC,kBAAkB,EAAE,CAAC,CAAC,CAAC;gBACnC,IAAI,CAAC,6BAA6B,CAAC,SAAS,CAAC,CAAC;YAChD,CAAC;YACD,IAAM,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAC1C,IAAM,UAAU,GAAG,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YACrD,IAAM,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC;YAC1E,IAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC;YACvE,IAAM,gBAAgB,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,WAAW,CAAE,GAAG,WAAW,CAAC,CAAC;YACzF,IAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,UAAU,GAAG,CAAC,CAAC,GAAG,WAAW,CAAE,GAAG,WAAW,CAAC,CAAC;YACtF,IAAI,CAAC,wBAAwB,CAAC,gBAAgB,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC;YAC1E,IAAI,CAAC,wBAAwB,CAAC,gBAAgB,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC;YAC1E,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC;YAChD,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,gBAAgB,CAAC,CAAC;QAClD,CAAC;QACD,IAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,SAAS,CAAC,CAAC;IAC1C,CAAC;IAED,6CAAmB,GAAnB,UAAoB,UAAsB;QACxC,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,SAAS,CAAC,UAAU,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QAC/C,CAAC;IACH,CAAC;IAED,qCAAW,GAAX,UAAY,mBAA+B,EAAE,iBAA6B;QACxE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC;YACvB,MAAM,CAAC;QACT,CAAC;QACD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC,CAAC;YAChC,IAAI,CAAC,qBAAqB,GAAG,mBAAmB,CAAC;QACnD,CAAC;QAED,IAAM,KAAK,GAAG,eAAe,CAAC,iBAAiB,CAAC,IAAI,CAAC,qBAAqB,EAAE,iBAAiB,CAAC,CAAC;QAC/F,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,KAAK;YAC1B,eAAe,CAAC,kBAAkB,CAAC,KAAK,CAAC,WAAW,EAAE,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QACvE,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,iBAAiB,EAAE,CAAC;QACzB,IAAI,CAAC,qBAAqB,GAAG,iBAAiB,CAAC;IACjD,CAAC;IAED,wCAAc,GAAd;QAAA,iBAIC;QAHC,IAAI,CAAC,qBAAqB,GAAG,SAAS,CAAC;QACvC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,KAAK,IAAI,OAAA,KAAI,CAAC,iBAAiB,CAAC,IAAI,EAAE,KAAK,CAAC,EAAnC,CAAmC,CAAC,CAAC;QACrE,IAAI,CAAC,mBAAmB,EAAE,CAAC;IAC7B,CAAC;IAED,qCAAW,GAAX,UAAY,aAAwB;QAApC,iBAWC;QAVC,IAAI,CAAC,cAAc,CAAC,aAAa,CAAC,CAAC;QACnC,IAAI,CAAC,SAAS;aACX,MAAM,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,kBAAkB,EAAE,EAAtB,CAAsB,CAAC;aACnC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,cAAc,CAAC,CAAC,CAAC,EAAtB,CAAsB,CAAC,CAAC;QACxC,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAE/B,IAAI,CAAC,eAAe,EAAE,CAAC;QACvB,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;YAC/B,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;QAC3C,CAAC;IACH,CAAC;IAED,sCAAY,GAAZ,UAAa,QAAoB;QAC/B,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;QACzB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACtC,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QACxB,IAAI,CAAC,mBAAmB,EAAE,CAAC;QAE3B,IAAI,CAAC,uBAAuB,EAAE,CAAC;IACjC,CAAC;IAED,0CAAgB,GAAhB;QACE,MAAM,CAAC,IAAI,CAAC,aAAa,EAAE,CAAC,GAAG,CAAC,UAAA,QAAQ,IAAI,OAAA,QAAQ,CAAC,WAAW,EAAE,EAAtB,CAAsB,CAAC,CAAC;IACtE,CAAC;IAED,uCAAa,GAAb;QAAA,iBAEC;QADC,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,UAAA,QAAQ,IAAI,OAAA,CAAC,QAAQ,CAAC,kBAAkB,EAAE,IAAI,QAAQ,KAAK,KAAI,CAAC,WAAW,EAA/D,CAA+D,CAAC,CAAC;IAC5G,CAAC;IAED,sCAAY,GAAZ;QACE,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,UAAA,QAAQ,IAAI,OAAA,QAAQ,CAAC,WAAW,EAAE,EAAtB,CAAsB,CAAC,CAAC;IAChE,CAAC;IAED,sCAAY,GAAZ;QACE,MAAM,CAAC,IAAI,MAAM,CAAC,gBAAgB,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC,CAAC;IAC1D,CAAC;IAEO,wCAAc,GAAtB,UAAuB,KAAgB;QACrC,IAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,UAAC,CAAC,IAAK,OAAA,CAAC,KAAK,KAAK,EAAX,CAAW,CAAC,CAAC;QAC3D,EAAE,CAAC,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;YACd,MAAM,CAAC;QACT,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;QAChC,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC;IACzC,CAAC;IAEO,6CAAmB,GAA3B;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;YAC/B,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,EAAE,CAAC,CAAC;QAC3C,CAAC;IACH,CAAC;IAEO,2CAAiB,GAAzB,UAA0B,eAAsB;QAAhD,iBAKC;QALyB,gCAAA,EAAA,sBAAsB;QAAE,gBAAsB;aAAtB,UAAsB,EAAtB,qBAAsB,EAAtB,IAAsB;YAAtB,+BAAsB;;QACtE,EAAE,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC;YACpB,IAAI,CAAC,eAAe,EAAE,CAAC;QACzB,CAAC;QACD,MAAM,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,EAAE,CAAC,EAArC,CAAqC,CAAC,CAAC;IAC7D,CAAC;IAED,iCAAO,GAAP;QAAA,iBAYC;QAXC,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAEnC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,SAAS;YAC9B,KAAI,CAAC,WAAW,CAAC,MAAM,CAAC,SAAS,CAAC,KAAK,EAAE,CAAC,CAAC;QAC7C,CAAC,CAAC,CAAC;QACH,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,IAAI,IAAI,OAAA,KAAI,CAAC,cAAc,CAAC,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,EAAxC,CAAwC,CAAC,CAAC;QACzE,EAAE,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,KAAK,EAAE,CAAC,CAAC;YAClD,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;QAC/B,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC;IAC5B,CAAC;IAED,wCAAc,GAAd;QACE,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;IAC/B,CAAC;IAED,+BAAK,GAAL;QACE,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC;IACjB,CAAC;IACH,sBAAC;AAAD,CAzUA,AAyUC,CAzUoC,QAAQ,GAyU5C","file":"editable-polygon.js","sourceRoot":"","sourcesContent":["import { AcEntity } from '../../angular-cesium/models/ac-entity';\r\nimport { EditPoint } from './edit-point';\r\nimport { EditPolyline } from './edit-polyline';\r\nimport { AcLayerComponent } from '../../angular-cesium/components/ac-layer/ac-layer.component';\r\nimport { Cartesian3 } from '../../angular-cesium/models/cartesian3';\r\nimport { CoordinateConverter } from '../../angular-cesium/services/coordinate-converter/coordinate-converter.service';\r\nimport { GeoUtilsService } from '../../angular-cesium/services/geo-utils/geo-utils.service';\r\nimport { PolygonEditOptions, PolygonProps } from './polygon-edit-options';\r\nimport { PointProps, PolylineProps } from './polyline-edit-options';\r\nimport { defaultLabelProps, LabelProps } from './label-props';\r\n\r\nexport class EditablePolygon extends AcEntity {\r\n  private positions: EditPoint[] = [];\r\n  private polylines: EditPolyline[] = [];\r\n  private movingPoint: EditPoint;\r\n  private doneCreation = false;\r\n  private _enableEdit = true;\r\n  private _polygonProps: PolygonProps;\r\n  private _defaultPointProps: PointProps;\r\n  private _defaultPolylineProps: PolylineProps;\r\n  private lastDraggedToPosition: Cartesian3;\r\n  private _labels: LabelProps[] = [];\r\n\r\n  constructor(private id: string,\r\n              private polygonsLayer: AcLayerComponent,\r\n              private pointsLayer: AcLayerComponent,\r\n              private polylinesLayer: AcLayerComponent,\r\n              private coordinateConverter: CoordinateConverter,\r\n              polygonOptions: PolygonEditOptions,\r\n              positions?: Cartesian3[]) {\r\n    super();\r\n    this.polygonProps = polygonOptions.polygonProps;\r\n    this.defaultPointProps = polygonOptions.pointProps;\r\n    this.defaultPolylineProps = polygonOptions.polylineProps;\r\n    if (positions && positions.length >= 3) {\r\n      this.createFromExisting(positions);\r\n    }\r\n  }\r\n\r\n  get labels(): LabelProps[] {\r\n    return this._labels;\r\n  }\r\n\r\n  set labels(labels: LabelProps[]) {\r\n    if (!labels) {\r\n      return;\r\n    }\r\n    const positions = this.getRealPositions();\r\n    this._labels = labels.map((label, index) => {\r\n      if (!label.position) {\r\n        label.position = positions[index];\r\n      }\r\n\r\n      return Object.assign({}, defaultLabelProps, label);\r\n    });\r\n  }\r\n\r\n  get defaultPolylineProps(): PolylineProps {\r\n    return this._defaultPolylineProps;\r\n  }\r\n\r\n  set defaultPolylineProps(value: PolylineProps) {\r\n    this._defaultPolylineProps = value;\r\n  }\r\n\r\n  get defaultPointProps(): PointProps {\r\n    return this._defaultPointProps;\r\n  }\r\n\r\n  get polygonProps(): PolygonProps {\r\n    return this._polygonProps;\r\n  }\r\n\r\n  set polygonProps(value: PolygonProps) {\r\n    this._polygonProps = value;\r\n  }\r\n\r\n  set defaultPointProps(value: PointProps) {\r\n    this._defaultPointProps = value;\r\n  }\r\n\r\n  get enableEdit() {\r\n    return this._enableEdit;\r\n  }\r\n\r\n  set enableEdit(value: boolean) {\r\n    this._enableEdit = value;\r\n    this.positions.forEach(point => {\r\n      point.show = value;\r\n      this.updatePointsLayer(false, point);\r\n    });\r\n  }\r\n\r\n  private createFromExisting(positions: Cartesian3[]) {\r\n    positions.forEach((position) => {\r\n      this.addPointFromExisting(position)\r\n    });\r\n    this.addAllVirtualEditPoints();\r\n    this.updatePolygonsLayer();\r\n    this.doneCreation = true;\r\n  }\r\n\r\n  setPointsManually(points: { position: Cartesian3, pointProps: PointProps }[] | Cartesian3[], polygonProps?: PolygonProps) {\r\n    if (!this.doneCreation) {\r\n      throw new Error('Update manually only in edit mode, after polygon is created')\r\n    }\r\n\r\n    this.positions.forEach(p => this.pointsLayer.remove(p.getId()));\r\n    const newPoints: EditPoint[] = [];\r\n    for (let i = 0; i < points.length; i++) {\r\n      const pointOrCartesian: any = points[i];\r\n      let newPoint = null;\r\n      if (pointOrCartesian.pointProps) {\r\n        newPoint = new EditPoint(this.id, pointOrCartesian.position, pointOrCartesian.pointProps);\r\n      } else {\r\n        newPoint = new EditPoint(this.id, pointOrCartesian, this.defaultPointProps);\r\n      }\r\n      newPoints.push(newPoint);\r\n    }\r\n    this.positions = newPoints;\r\n    this.polygonProps = polygonProps ? polygonProps : this.polygonProps;\r\n    this.updatePointsLayer(true, ...this.positions);\r\n    this.addAllVirtualEditPoints();\r\n    this.updatePolygonsLayer();\r\n  }\r\n\r\n  private addAllVirtualEditPoints() {\r\n    const currentPoints = [...this.positions];\r\n    currentPoints.forEach((pos, index) => {\r\n      const currentPoint = pos;\r\n      const nextIndex = (index + 1) % (currentPoints.length);\r\n      const nextPoint = currentPoints[nextIndex];\r\n      const midPoint = this.setMiddleVirtualPoint(currentPoint, nextPoint);\r\n      this.updatePointsLayer(false, midPoint);\r\n    });\r\n  }\r\n\r\n  private setMiddleVirtualPoint(firstP: EditPoint, secondP: EditPoint): EditPoint {\r\n    const currentCart = Cesium.Cartographic.fromCartesian(firstP.getPosition());\r\n    const nextCart = Cesium.Cartographic.fromCartesian(secondP.getPosition());\r\n    const midPointCartesian3 = this.coordinateConverter.midPointToCartesian3(currentCart, nextCart);\r\n    const midPoint = new EditPoint(this.id, midPointCartesian3, this.defaultPointProps);\r\n    midPoint.setVirtualEditPoint(true);\r\n\r\n    const firstIndex = this.positions.indexOf(firstP);\r\n    this.positions.splice(firstIndex + 1, 0, midPoint);\r\n    return midPoint;\r\n  }\r\n\r\n  private updateMiddleVirtualPoint(virtualEditPoint: EditPoint, prevPoint: EditPoint, nextPoint: EditPoint) {\r\n    const prevPointCart = Cesium.Cartographic.fromCartesian(prevPoint.getPosition());\r\n    const nextPointCart = Cesium.Cartographic.fromCartesian(nextPoint.getPosition());\r\n    virtualEditPoint.setPosition(this.coordinateConverter.midPointToCartesian3(prevPointCart, nextPointCart));\r\n  }\r\n\r\n  changeVirtualPointToRealPoint(point: EditPoint) {\r\n    point.setVirtualEditPoint(false); // virtual point becomes a real point\r\n    const pointsCount = this.positions.length;\r\n    const pointIndex = this.positions.indexOf(point);\r\n    const nextIndex = (pointIndex + 1) % (pointsCount);\r\n    const preIndex = ((pointIndex - 1) + pointsCount ) % pointsCount;\r\n\r\n    const nextPoint = this.positions[nextIndex];\r\n    const prePoint = this.positions[preIndex];\r\n\r\n    const firstMidPoint = this.setMiddleVirtualPoint(prePoint, point);\r\n    const secMidPoint = this.setMiddleVirtualPoint(point, nextPoint);\r\n    this.updatePointsLayer(true, firstMidPoint, secMidPoint, point);\r\n    this.updatePolygonsLayer();\r\n\r\n  }\r\n\r\n  private renderPolylines() {\r\n    this.polylines.forEach(polyline => this.polylinesLayer.remove(polyline.getId()));\r\n    this.polylines = [];\r\n    const realPoints = this.positions.filter(pos => !pos.isVirtualEditPoint());\r\n    realPoints.forEach((point, index) => {\r\n      const nextIndex = (index + 1) % (realPoints.length);\r\n      const nextPoint = realPoints[nextIndex];\r\n      const polyline = new EditPolyline(this.id, point.getPosition(), nextPoint.getPosition(), this.defaultPolylineProps);\r\n      this.polylines.push(polyline);\r\n      this.polylinesLayer.update(polyline, polyline.getId());\r\n    });\r\n  }\r\n\r\n  addPointFromExisting(position: Cartesian3) {\r\n    const newPoint = new EditPoint(this.id, position, this.defaultPointProps);\r\n    this.positions.push(newPoint);\r\n    this.updatePointsLayer(true, newPoint);\r\n  }\r\n\r\n\r\n  addPoint(position: Cartesian3) {\r\n    if (this.doneCreation) {\r\n      return;\r\n    }\r\n    const isFirstPoint = !this.positions.length;\r\n    if (isFirstPoint) {\r\n      const firstPoint = new EditPoint(this.id, position, this.defaultPointProps);\r\n      this.positions.push(firstPoint);\r\n      this.updatePointsLayer(true, firstPoint);\r\n    }\r\n\r\n    this.movingPoint = new EditPoint(this.id, position.clone(), this.defaultPointProps);\r\n    this.positions.push(this.movingPoint);\r\n\r\n    this.updatePointsLayer(true, this.movingPoint);\r\n    this.updatePolygonsLayer();\r\n  }\r\n\r\n  movePoint(toPosition: Cartesian3, editPoint: EditPoint) {\r\n    editPoint.setPosition(toPosition);\r\n    this.updatePolygonsLayer();\r\n    if (this.doneCreation) {\r\n      if (editPoint.isVirtualEditPoint()) {\r\n        this.changeVirtualPointToRealPoint(editPoint);\r\n      }\r\n      const pointsCount = this.positions.length;\r\n      const pointIndex = this.positions.indexOf(editPoint);\r\n      const nextVirtualPoint = this.positions[(pointIndex + 1) % (pointsCount)];\r\n      const nextRealPoint = this.positions[(pointIndex + 2) % (pointsCount)];\r\n      const prevVirtualPoint = this.positions[((pointIndex - 1) + pointsCount ) % pointsCount];\r\n      const prevRealPoint = this.positions[((pointIndex - 2) + pointsCount ) % pointsCount];\r\n      this.updateMiddleVirtualPoint(nextVirtualPoint, editPoint, nextRealPoint);\r\n      this.updateMiddleVirtualPoint(prevVirtualPoint, editPoint, prevRealPoint);\r\n      this.updatePointsLayer(false, nextVirtualPoint);\r\n      this.updatePointsLayer(false, prevVirtualPoint);\r\n    }\r\n    this.updatePointsLayer(true, editPoint);\r\n  }\r\n\r\n  moveTempMovingPoint(toPosition: Cartesian3) {\r\n    if (this.movingPoint) {\r\n      this.movePoint(toPosition, this.movingPoint);\r\n    }\r\n  }\r\n\r\n  movePolygon(startMovingPosition: Cartesian3, draggedToPosition: Cartesian3) {\r\n    if (!this.doneCreation) {\r\n      return;\r\n    }\r\n    if (!this.lastDraggedToPosition) {\r\n      this.lastDraggedToPosition = startMovingPosition;\r\n    }\r\n\r\n    const delta = GeoUtilsService.getPositionsDelta(this.lastDraggedToPosition, draggedToPosition);\r\n    this.positions.forEach(point => {\r\n      GeoUtilsService.addDeltaToPosition(point.getPosition(), delta, true);\r\n    });\r\n    this.updatePointsLayer();\r\n    this.lastDraggedToPosition = draggedToPosition;\r\n  }\r\n\r\n  endMovePolygon() {\r\n    this.lastDraggedToPosition = undefined;\r\n    this.positions.forEach(point => this.updatePointsLayer(true, point));\r\n    this.updatePolygonsLayer();\r\n  }\r\n\r\n  removePoint(pointToRemove: EditPoint) {\r\n    this.removePosition(pointToRemove);\r\n    this.positions\r\n      .filter(p => p.isVirtualEditPoint())\r\n      .forEach(p => this.removePosition(p));\r\n    this.addAllVirtualEditPoints();\r\n\r\n    this.renderPolylines();\r\n    if (this.getPointsCount() >= 3) {\r\n      this.polygonsLayer.update(this, this.id);\r\n    }\r\n  }\r\n\r\n  addLastPoint(position: Cartesian3) {\r\n    this.doneCreation = true;\r\n    this.removePosition(this.movingPoint); // remove movingPoint\r\n    this.movingPoint = null;\r\n    this.updatePolygonsLayer();\r\n\r\n    this.addAllVirtualEditPoints();\r\n  }\r\n\r\n  getRealPositions(): Cartesian3[] {\r\n    return this.getRealPoints().map(position => position.getPosition());\r\n  }\r\n\r\n  getRealPoints(): EditPoint[] {\r\n    return this.positions.filter(position => !position.isVirtualEditPoint() && position !== this.movingPoint);\r\n  }\r\n\r\n  getPositions(): Cartesian3[] {\r\n    return this.positions.map(position => position.getPosition());\r\n  }\r\n\r\n  getHierarchy() {\r\n    return new Cesium.PolygonHierarchy(this.getPositions());\r\n  }\r\n\r\n  private removePosition(point: EditPoint) {\r\n    const index = this.positions.findIndex((p) => p === point);\r\n    if (index < 0) {\r\n      return;\r\n    }\r\n    this.positions.splice(index, 1);\r\n    this.pointsLayer.remove(point.getId());\r\n  }\r\n\r\n  private updatePolygonsLayer() {\r\n    if (this.getPointsCount() >= 3) {\r\n      this.polygonsLayer.update(this, this.id);\r\n    }\r\n  }\r\n\r\n  private updatePointsLayer(renderPolylines = true, ...points: EditPoint[]) {\r\n    if (renderPolylines) {\r\n      this.renderPolylines();\r\n    }\r\n    points.forEach(p => this.pointsLayer.update(p, p.getId()));\r\n  }\r\n\r\n  dispose() {\r\n    this.polygonsLayer.remove(this.id);\r\n\r\n    this.positions.forEach(editPoint => {\r\n      this.pointsLayer.remove(editPoint.getId());\r\n    });\r\n    this.polylines.forEach(line => this.polylinesLayer.remove(line.getId()));\r\n    if (this.movingPoint) {\r\n      this.pointsLayer.remove(this.movingPoint.getId());\r\n      this.movingPoint = undefined;\r\n    }\r\n    this.positions.length = 0;\r\n  }\r\n\r\n  getPointsCount(): number {\r\n    return this.positions.length;\r\n  }\r\n\r\n  getId() {\r\n    return this.id;\r\n  }\r\n}\r\n"]}