{"version":3,"sources":["basic-desc.service.ts"],"names":[],"mappings":"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","file":"basic-desc.service.js","sourceRoot":"","sourcesContent":["import { EventEmitter, Input, OnDestroy, OnInit, Output } from '@angular/core';\r\nimport { LayerService } from '../layer-service/layer-service.service';\r\nimport { ComputationCache } from '../computation-cache/computation-cache.service';\r\nimport { CesiumProperties } from '../cesium-properties/cesium-properties.service';\r\nimport { AcEntity } from '../../models/ac-entity';\r\nimport { BasicDrawerService } from '../drawers/basic-drawer/basic-drawer.service';\r\nimport { IDescription } from '../../models/description';\r\n\r\nexport interface OnDrawParams {\r\n  acEntity: AcEntity;\r\n  entityId: string;\r\n  cesiumEntity: any;\r\n}\r\n\r\n/**\r\n *  the ancestor class for creating components.\r\n *  extend this class to create desc component.\r\n */\r\nexport class BasicDesc implements OnInit, OnDestroy, IDescription {\r\n  \r\n  props: any;\r\n\r\n  \r\n  onDraw: EventEmitter<OnDrawParams> = new EventEmitter<OnDrawParams>();\r\n\r\n  \r\n  onRemove: EventEmitter<OnDrawParams> = new EventEmitter<OnDrawParams>();\r\n\r\n  protected _cesiumObjectsMap: Map<string, any> = new Map<string, any>();\r\n  private _propsEvaluateFn: Function;\r\n  private _propsAssignerFn: Function;\r\n  constructor(protected _drawer: BasicDrawerService,\r\n              protected _layerService: LayerService,\r\n              protected _computationCache: ComputationCache,\r\n              protected _cesiumProperties: CesiumProperties) {\r\n  }\r\n\r\n  protected _propsEvaluator(context: Object): any {\r\n    return this._propsEvaluateFn(this._computationCache, context);\r\n  }\r\n\r\n  protected _getPropsAssigner(): (cesiumObject: Object, desc: Object) => Object {\r\n    return (cesiumObject: Object, desc: Object) => this._propsAssignerFn(cesiumObject, desc);\r\n  }\r\n\r\n  getLayerService(): LayerService {\r\n    return this._layerService;\r\n  }\r\n\r\n  setLayerService(layerService: LayerService) {\r\n    this._layerService.unregisterDescription(this);\r\n    this._layerService = layerService;\r\n    this._layerService.registerDescription(this);\r\n    this._propsEvaluateFn = this._cesiumProperties.createEvaluator(this.props, this._layerService.cache, true);\r\n    this._propsAssignerFn = this._cesiumProperties.createAssigner(this.props);\r\n  }\r\n\r\n  ngOnInit(): void {\r\n    if (!this.props) {\r\n      console.error('ac-desc components error: [props] input is mandatory');\r\n    }\r\n\r\n    this._layerService.registerDescription(this);\r\n    this._propsEvaluateFn = this._cesiumProperties.createEvaluator(this.props, this._layerService.cache);\r\n    this._propsAssignerFn = this._cesiumProperties.createAssigner(this.props);\r\n  }\r\n\r\n  public getCesiumObjectsMap(): Map<string, any> {\r\n    return this._cesiumObjectsMap;\r\n  }\r\n\r\n  draw(context: any, id: string, entity: AcEntity): void {\r\n    const cesiumProps = this._propsEvaluator(context);\r\n\r\n    if (!this._cesiumObjectsMap.has(id)) {\r\n      const cesiumObject = this._drawer.add(cesiumProps);\r\n      this.onDraw.emit({\r\n        acEntity: entity,\r\n        cesiumEntity: cesiumObject,\r\n        entityId: id,\r\n      });\r\n      cesiumObject.acEntity = entity; // set the entity on the cesiumObject for later usage\r\n      this._cesiumObjectsMap.set(id, cesiumObject);\r\n    } else {\r\n      const cesiumObject = this._cesiumObjectsMap.get(id);\r\n      this.onDraw.emit({\r\n        acEntity: entity,\r\n        cesiumEntity: cesiumObject,\r\n        entityId: id,\r\n      });\r\n      cesiumObject.acEntity = entity; // set the entity on the cesiumObject for later usage\r\n      this._drawer.setPropsAssigner(this._getPropsAssigner());\r\n      this._drawer.update(cesiumObject, cesiumProps);\r\n    }\r\n  }\r\n\r\n  remove(id: string) {\r\n    const cesiumObject = this._cesiumObjectsMap.get(id);\r\n    if (cesiumObject) {\r\n      this.onRemove.emit({\r\n        acEntity: cesiumObject.acEntity,\r\n        cesiumEntity: cesiumObject,\r\n        entityId: id,\r\n      });\r\n      this._drawer.remove(cesiumObject);\r\n      this._cesiumObjectsMap.delete(id);\r\n    }\r\n  }\r\n\r\n  removeAll() {\r\n    this._cesiumObjectsMap.clear();\r\n    this._drawer.removeAll();\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    this._layerService.unregisterDescription(this);\r\n    this.removeAll();\r\n  }\r\nstatic propDecorators: {[key: string]: DecoratorInvocation[]} = {\n'props': [{ type: Input },],\n'onDraw': [{ type: Output },],\n'onRemove': [{ type: Output },],\n};\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}