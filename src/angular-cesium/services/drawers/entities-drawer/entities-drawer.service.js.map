{"version":3,"sources":["entities-drawer.service.ts"],"names":[],"mappings":"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","file":"entities-drawer.service.js","sourceRoot":"","sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { BasicDrawerService } from '../basic-drawer/basic-drawer.service';\r\nimport { CesiumService } from '../../cesium/cesium.service';\r\nimport { GraphicsType } from './enums/graphics-type.enum';\r\nimport { EntitiesDrawerOptions } from '../../../models/entities-drawer-options';\r\nimport { OptimizedEntityCollection } from './optimized-entity-collection';\r\n\r\n/**\r\n *  General primitives drawer responsible of drawing Cesium primitives.\r\n *  Drawers the handle Cesium primitives extend it.\r\n */\r\n\r\n\r\nexport class EntitiesDrawerService extends BasicDrawerService {\r\n\tprivate entityCollections = new Map<any, OptimizedEntityCollection>();\r\n\tprivate graphicsTypeName: string;\r\n\r\n\tconstructor(private cesiumService: CesiumService,\r\n\t\tprivate graphicsType: GraphicsType,\r\n\t\tprivate defaultOptions: EntitiesDrawerOptions = {\r\n\t\t\tcollectionMaxSize: -1,\r\n\t\t\tcollectionSuspensionTime: -1,\r\n\t\t\tcollectionsNumber: 1\r\n\t\t}) {\r\n\t\tsuper();\r\n\t\tthis.graphicsTypeName = GraphicsType[this.graphicsType];\r\n\t}\r\n\r\n\tprivate getFreeEntitiesCollection(): OptimizedEntityCollection {\r\n\t\tlet freeEntityCollection = null;\r\n\t\tthis.entityCollections.forEach((entityCollection) => {\r\n\t\t\tif (entityCollection.isFree()) {\r\n\t\t\t\tfreeEntityCollection = entityCollection;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn freeEntityCollection;\r\n\t}\r\n\r\n\tinit(options?: EntitiesDrawerOptions) {\r\n\t\tconst finalOptions = options || this.defaultOptions;\r\n\t\tconst dataSources = [];\r\n\t\tfor (let i = 0; i < finalOptions.collectionsNumber; i++) {\r\n\t\t\tconst dataSource = new Cesium.CustomDataSource();\r\n\t\t\tdataSources.push(dataSource);\r\n\t\t\tthis.entityCollections.set(dataSource.entities,\r\n\t\t\t\tnew OptimizedEntityCollection(\r\n\t\t\t\t\tdataSource.entities,\r\n\t\t\t\t\tfinalOptions.collectionMaxSize,\r\n\t\t\t\t\tfinalOptions.collectionSuspensionTime));\r\n\t\t}\r\n\r\n\t\treturn dataSources;\r\n\t}\r\n\r\n\tadd(cesiumProps: any): any {\r\n\t\tconst optimizedEntityCollection = this.getFreeEntitiesCollection();\r\n\t\tif (optimizedEntityCollection === null) {\r\n\t\t\tthrow new Error('No more free entity collections');\r\n\t\t}\r\n\r\n\t\tconst graphicsClass = this.graphicsType as any;\r\n\t\tconst entityObject = {\r\n\t\t\tposition: cesiumProps.position !== undefined ? cesiumProps.position : undefined,\r\n\t\t\tdescription: cesiumProps.description !== undefined ? cesiumProps.description : undefined,\r\n\t\t\torientation: cesiumProps.orientation !== undefined ? cesiumProps.orientation : undefined,\r\n\t\t\tviewFrom: cesiumProps.viewFrom !== undefined ? cesiumProps.viewFrom : undefined,\r\n\t\t\tavailability: cesiumProps.availability !== undefined ? cesiumProps.availability : undefined,\r\n\t\t\t[this.graphicsTypeName]: cesiumProps,\r\n\t\t};\r\n\r\n\t\tif (cesiumProps.name !== undefined) {\r\n\t\t\tentityObject.name = cesiumProps.name;\r\n\t\t}\r\n\r\n\t\treturn optimizedEntityCollection.add(entityObject);\r\n\t}\r\n\r\n\tupdate(entity: any, cesiumProps: any) {\r\n\t\tthis.suspendEntityCollection(entity);\r\n\r\n\t\tentity.position = cesiumProps.position !== undefined ? cesiumProps.position : undefined;\r\n\t\tentity.name = cesiumProps.name !== undefined ? cesiumProps.name : entity.name;\r\n\t\tentity.description = cesiumProps.description !== undefined ? cesiumProps.description : entity.description;\r\n\t\tentity.orientation = cesiumProps.orientation !== undefined ? cesiumProps.orientation : entity.orientation;\r\n\t\tentity.viewFrom = cesiumProps.viewFrom !== undefined ? cesiumProps.viewFrom : entity.viewFrom;\r\n\t\tentity.availability = cesiumProps.availability !== undefined ? cesiumProps.availability : undefined;\r\n\r\n\t\tif (this._propsAssigner) {\r\n\t\t\tthis._propsAssigner(entity[this.graphicsTypeName], cesiumProps);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tObject.assign(entity[this.graphicsTypeName], cesiumProps);\r\n\t\t}\r\n\t}\r\n\r\n\tremove(entity: any) {\r\n\t\tconst optimizedEntityCollection = this.entityCollections.get(entity.entityCollection);\r\n\t\toptimizedEntityCollection.remove(entity);\r\n\t}\r\n\r\n\tremoveAll() {\r\n\t\tthis.entityCollections.forEach((entityCollection) => {\r\n\t\t\tentityCollection.removeAll();\r\n\t\t});\r\n\t}\r\n\r\n\tsetShow(showValue: boolean) {\r\n\t\tthis.entityCollections.forEach((entityCollection) => {\r\n\t\t\tentityCollection.setShow(showValue);\r\n\t\t});\r\n\t}\r\n\r\n\tprivate suspendEntityCollection(entity: any) {\r\n\t\tconst id = entity.entityCollection;\r\n\t\tif (!this.entityCollections.has(id)) {\r\n\t\t\tthrow new Error('No EntityCollection for entity.entityCollection');\r\n\t\t}\r\n\r\n\t\tconst entityCollection = this.entityCollections.get(id);\r\n\t\tentityCollection.suspend();\r\n\t}\r\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: () => ({type: any, decorators?: DecoratorInvocation[]}|null)[] = () => [\n{type: CesiumService, },\n{type: GraphicsType, },\nnull,\n];\n}\r\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}