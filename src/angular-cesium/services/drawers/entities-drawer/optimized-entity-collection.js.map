{"version":3,"sources":["optimized-entity-collection.ts"],"names":[],"mappings":"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","file":"optimized-entity-collection.js","sourceRoot":"","sourcesContent":["export class OptimizedEntityCollection {\r\n  private _updateRate: number;\r\n  private _collectionSize: number;\r\n  private _isSuspended = false;\r\n  private _isHardSuspend = false;\r\n  private _suspensionTimeout: any;\r\n  private _onEventSuspensionCallback: { once: boolean, callback: Function };\r\n  private _onEventResumeCallback: { once: boolean, callback: Function };\r\n  \r\n  constructor(private entityCollection: any, collectionSize = -1, updateRate = -1) {\r\n    this._updateRate = updateRate;\r\n    this._collectionSize = collectionSize;\r\n    \r\n  }\r\n  \r\n  setShow(show: boolean) {\r\n    this.entityCollection.show = show;\r\n  }\r\n  \r\n  get isSuspended(): boolean {\r\n    return this._isSuspended;\r\n  }\r\n  \r\n  get updateRate(): number {\r\n    return this._updateRate;\r\n  }\r\n  \r\n  set updateRate(value: number) {\r\n    this._updateRate = value;\r\n  }\r\n  \r\n  get collectionSize(): number {\r\n    return this._collectionSize;\r\n  }\r\n  \r\n  set collectionSize(value: number) {\r\n    this._collectionSize = value;\r\n  }\r\n  \r\n  collection() {\r\n    return this.entityCollection;\r\n  }\r\n  \r\n  isFree(): boolean {\r\n    return this._collectionSize < 1 || this.entityCollection.values.length < this._collectionSize;\r\n  }\r\n  \r\n  add(entity: any) {\r\n    this.suspend();\r\n    return this.entityCollection.add(entity);\r\n  }\r\n  \r\n  remove(entity: any) {\r\n    this.suspend();\r\n    return this.entityCollection.remove(entity);\r\n  }\r\n  \r\n  removeNoSuspend(entity: any) {\r\n    this.entityCollection.remove(entity);\r\n  }\r\n  \r\n  removeAll() {\r\n    this.suspend();\r\n    this.entityCollection.removeAll();\r\n  }\r\n  \r\n  onEventSuspension(callback: Function, once = false): Function {\r\n    this._onEventSuspensionCallback = { callback, once };\r\n    return () => {\r\n      this._onEventSuspensionCallback = undefined;\r\n    };\r\n  }\r\n  \r\n  onEventResume(callback: Function, once = false): Function {\r\n    this._onEventResumeCallback = { callback, once };\r\n    if (!this._isSuspended) {\r\n      this.triggerEventResume();\r\n    }\r\n    return () => {\r\n      this._onEventResumeCallback = undefined;\r\n    };\r\n  }\r\n  \r\n  triggerEventSuspension() {\r\n    if (this._onEventSuspensionCallback !== undefined) {\r\n      const callback = this._onEventSuspensionCallback.callback;\r\n      if (this._onEventSuspensionCallback.once) {\r\n        this._onEventSuspensionCallback = undefined;\r\n      }\r\n      callback();\r\n    }\r\n  }\r\n  \r\n  triggerEventResume() {\r\n    if (this._onEventResumeCallback !== undefined) {\r\n      const callback = this._onEventResumeCallback.callback;\r\n      if (this._onEventResumeCallback.once) {\r\n        this._onEventResumeCallback = undefined;\r\n      }\r\n      callback();\r\n    }\r\n  }\r\n  \r\n  public suspend() {\r\n    if (this._updateRate < 0) {\r\n      return;\r\n    }\r\n    if (this._isHardSuspend) {\r\n      return;\r\n    }\r\n    if (!this._isSuspended) {\r\n      this._isSuspended = true;\r\n      this.entityCollection.suspendEvents();\r\n      this.triggerEventSuspension();\r\n      this._suspensionTimeout = setTimeout(() => {\r\n        this.entityCollection.resumeEvents();\r\n        this.triggerEventResume();\r\n        this._isSuspended = false;\r\n        this._suspensionTimeout = undefined;\r\n      }, this._updateRate);\r\n    }\r\n  }\r\n  \r\n  public hardSuspend() {\r\n    this.entityCollection.suspendEvents();\r\n    this._isHardSuspend = true;\r\n  }\r\n  \r\n  public hardResume() {\r\n    this.entityCollection.resumeEvents();\r\n    this._isHardSuspend = false;\r\n  }\r\n  \r\n}\r\n"]}